'use strict';const a6_0x1941db=a6_0x4040;(function(_0x4ab660,_0x1e2906){const _0x4ecca0=a6_0x4040,_0xe838b7=_0x4ab660();while(!![]){try{const _0x248209=-parseInt(_0x4ecca0(0x192))/0x1*(-parseInt(_0x4ecca0(0x173))/0x2)+-parseInt(_0x4ecca0(0x1a6))/0x3*(-parseInt(_0x4ecca0(0x1a8))/0x4)+-parseInt(_0x4ecca0(0x150))/0x5+-parseInt(_0x4ecca0(0x1aa))/0x6+parseInt(_0x4ecca0(0x182))/0x7+parseInt(_0x4ecca0(0x151))/0x8+parseInt(_0x4ecca0(0x14b))/0x9*(-parseInt(_0x4ecca0(0x17a))/0xa);if(_0x248209===_0x1e2906)break;else _0xe838b7['push'](_0xe838b7['shift']());}catch(_0x34a894){_0xe838b7['push'](_0xe838b7['shift']());}}}(a6_0x52a0,0xef6a0));var __awaiter=this&&this[a6_0x1941db(0x19c)]||function(_0x30c0bf,_0xad47b2,_0xab907d,_0x1d12f6){function _0x4c99e3(_0x547931){return _0x547931 instanceof _0xab907d?_0x547931:new _0xab907d(function(_0x28ec0f){_0x28ec0f(_0x547931);});}return new(_0xab907d||(_0xab907d=Promise))(function(_0xa7a907,_0x37ebf9){const _0x308391=a6_0x4040;function _0x3a4fdb(_0x553e78){const _0x12cf3a=a6_0x4040;try{_0xcda969(_0x1d12f6[_0x12cf3a(0x1a1)](_0x553e78));}catch(_0x59b8aa){_0x37ebf9(_0x59b8aa);}}function _0x549fc9(_0x259768){const _0xc7755d=a6_0x4040;try{_0xcda969(_0x1d12f6[_0xc7755d(0x1a7)](_0x259768));}catch(_0x4a390e){_0x37ebf9(_0x4a390e);}}function _0xcda969(_0x1e6c2d){const _0x2ceac1=a6_0x4040;_0x1e6c2d[_0x2ceac1(0x161)]?_0xa7a907(_0x1e6c2d[_0x2ceac1(0x17d)]):_0x4c99e3(_0x1e6c2d[_0x2ceac1(0x17d)])[_0x2ceac1(0x16c)](_0x3a4fdb,_0x549fc9);}_0xcda969((_0x1d12f6=_0x1d12f6[_0x308391(0x170)](_0x30c0bf,_0xad47b2||[]))[_0x308391(0x1a1)]());});},__importDefault=this&&this[a6_0x1941db(0x18d)]||function(_0x559c4b){return _0x559c4b&&_0x559c4b['__esModule']?_0x559c4b:{'default':_0x559c4b};};function a6_0x4040(_0x40fea7,_0x48dd5e){const _0x52a08e=a6_0x52a0();return a6_0x4040=function(_0x4040a4,_0x23c7c5){_0x4040a4=_0x4040a4-0x14b;let _0x46ff4b=_0x52a08e[_0x4040a4];return _0x46ff4b;},a6_0x4040(_0x40fea7,_0x48dd5e);}Object[a6_0x1941db(0x15d)](exports,a6_0x1941db(0x172),{'value':!![]});function a6_0x52a0(){const _0x488e33=['hash','default','compare','Delete\x20displays\x20related','/register','Login\x20successful','At\x20least\x20one\x20field\x20is\x20required\x20to\x20update\x20the\x20profile','Invalid\x20email\x20or\x20password','/account','Router','then','Account\x20deleted\x20successfully','findOne','noreply@things-connect.net','apply','_id','__esModule','1448VIjOTk','ResponseHandler','bcrypt','../models/User','User\x20not\x20found','select','Token\x20decoding\x20failed:','170spJtub','Invalid\x20token\x20signature','body','value','randomBytes','../handlers/error_handler','RESET\x20PASSWORD','post','10602410AEQMxB','hex','Get\x20Profile\x20Error:','jsonwebtoken','email','NO_REPLY_MAIL','Internal\x20server\x20error:\x20','save','-password\x20-resetKey','env','log','__importDefault','Forgot\x20Password\x20Error:','notFound','Token\x20refreshed\x20successfully','put','691xNbgSE','NO_REPLY_MAIL_PASS','User\x20profile\x20retrieved\x20successfully','regal_refresh_secret_999','regal_top_secret','User\x20registered\x20successfully','internalServerError','Missing\x20required\x20fields','nodemailer','../models/Display','__awaiter','User','unauthorized','toString','REFRESH_SECRET','next','password\x20reset\x20success!','Display','crypto','Delete\x20Account\x20Error:','939curoPm','throw','10432kbKiQt','success','9012810eNpGEk','682965memRPH','JWT_SECRET','verify','Edit\x20Profile\x20Error:','resetKey','1304535UBPkkZ','9620072KfGfhm','sendMail','userId','/login','User\x20profile\x20updated\x20successfully','/forgot-password','failure:\x20','express','get','Refresh\x20token\x20is\x20required','delete','gmail','defineProperty','sign','error','Your\x20password\x20reset\x20key\x20is:\x20','done'];a6_0x52a0=function(){return _0x488e33;};return a6_0x52a0();}const express_1=__importDefault(require(a6_0x1941db(0x158))),bcrypt_1=__importDefault(require(a6_0x1941db(0x175))),jsonwebtoken_1=__importDefault(require(a6_0x1941db(0x185))),nodemailer_1=__importDefault(require(a6_0x1941db(0x19a))),crypto_1=__importDefault(require(a6_0x1941db(0x1a4))),User_1=require(a6_0x1941db(0x176)),authorise_1=__importDefault(require('../middlewares/authorise')),Display_1=require(a6_0x1941db(0x19b)),error_handler_1=require(a6_0x1941db(0x17f)),router=express_1[a6_0x1941db(0x163)][a6_0x1941db(0x16b)]();router[a6_0x1941db(0x181)](a6_0x1941db(0x166),(_0x277734,_0xced049)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3adb56=a6_0x1941db;try{const {firstName:_0x152ec9,lastName:_0x350e48,email:_0x229200,password:_0x7eb023,phone:_0x95abc3,age:_0x1feb74,address:_0x276761}=_0x277734[_0x3adb56(0x17c)];if(!_0x152ec9||!_0x350e48||!_0x229200||!_0x7eb023){error_handler_1[_0x3adb56(0x174)][_0x3adb56(0x15f)](_0xced049,_0x3adb56(0x199),0x195);return;}const _0x3a463c=yield User_1['User'][_0x3adb56(0x16e)]({'email':_0x229200});if(_0x3a463c){error_handler_1[_0x3adb56(0x174)][_0x3adb56(0x15f)](_0xced049,'User\x20already\x20exists',0x195);return;}const _0x340550=0xa,_0xb51694=yield bcrypt_1['default'][_0x3adb56(0x162)](_0x7eb023,_0x340550),_0x1d70bd=new User_1[(_0x3adb56(0x19d))]({'firstName':_0x152ec9,'lastName':_0x350e48,'email':_0x229200,'password':_0xb51694,'phone':_0x95abc3,'age':_0x1feb74,'address':_0x276761});yield _0x1d70bd['save'](),error_handler_1[_0x3adb56(0x174)][_0x3adb56(0x1a9)](_0xced049,_0x1d70bd,_0x3adb56(0x197));}catch(_0x3b1aee){error_handler_1['ResponseHandler']['internalServerError'](_0xced049,_0x3adb56(0x188)+_0x3b1aee);}})),router[a6_0x1941db(0x181)](a6_0x1941db(0x154),(_0x4f8b83,_0x3d73ae)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4cdda6=a6_0x1941db;try{const {email:_0x48fe78,password:_0x342c4c}=_0x4f8b83[_0x4cdda6(0x17c)],_0x3dde74=yield User_1['User'][_0x4cdda6(0x16e)]({'email':_0x48fe78});if(!_0x3dde74){error_handler_1[_0x4cdda6(0x174)]['notFound'](_0x3d73ae,_0x4cdda6(0x169));return;}const _0x3b534f=yield bcrypt_1[_0x4cdda6(0x163)][_0x4cdda6(0x164)](_0x342c4c,_0x3dde74['password']);if(!_0x3b534f){error_handler_1[_0x4cdda6(0x174)][_0x4cdda6(0x19e)](_0x3d73ae,_0x4cdda6(0x169));return;}const _0x50d52a=jsonwebtoken_1[_0x4cdda6(0x163)][_0x4cdda6(0x15e)]({'_id':_0x3dde74['_id'],'email':_0x3dde74['email']},process[_0x4cdda6(0x18b)]['JWT_SECRET']||_0x4cdda6(0x196),{'expiresIn':'5h'}),_0x10c563=jsonwebtoken_1['default']['sign']({'_id':_0x3dde74[_0x4cdda6(0x171)],'email':_0x3dde74[_0x4cdda6(0x186)]},process[_0x4cdda6(0x18b)][_0x4cdda6(0x1a0)]||_0x4cdda6(0x195),{'expiresIn':'20d'}),_0x4605ff={'user':_0x3dde74,'token':_0x50d52a,'refreshToken':_0x10c563};error_handler_1[_0x4cdda6(0x174)][_0x4cdda6(0x1a9)](_0x3d73ae,_0x4605ff,_0x4cdda6(0x167));}catch(_0x4f57b8){error_handler_1['ResponseHandler'][_0x4cdda6(0x198)](_0x3d73ae,_0x4cdda6(0x188)+_0x4f57b8);}})),router[a6_0x1941db(0x181)](a6_0x1941db(0x156),(_0x36bd49,_0x57f2b2)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3657e3=a6_0x1941db;try{const {email:_0x2dcd08}=_0x36bd49[_0x3657e3(0x17c)],_0x334d65=yield User_1[_0x3657e3(0x19d)]['findOne']({'email':_0x2dcd08});if(!_0x334d65){error_handler_1[_0x3657e3(0x174)][_0x3657e3(0x18f)](_0x57f2b2,'User\x20with\x20this\x20email\x20does\x20not\x20exist');return;}const _0x4d704c=crypto_1[_0x3657e3(0x163)][_0x3657e3(0x17e)](0x4)[_0x3657e3(0x19f)](_0x3657e3(0x183))['toUpperCase']();_0x334d65['resetKey']=_0x4d704c,yield _0x334d65[_0x3657e3(0x189)]();const _0x55af34=nodemailer_1[_0x3657e3(0x163)]['createTransport']({'service':_0x3657e3(0x15c),'auth':{'user':process[_0x3657e3(0x18b)][_0x3657e3(0x187)],'pass':process[_0x3657e3(0x18b)][_0x3657e3(0x193)]}}),_0x1bd7fc={'from':_0x3657e3(0x16f),'to':_0x2dcd08,'subject':_0x3657e3(0x180),'text':_0x3657e3(0x160)+_0x4d704c+'.\x20It\x20is\x20valid\x20for\x2010\x20minutes.'};_0x55af34[_0x3657e3(0x152)](_0x1bd7fc,function(_0xe8b134,_0x3e6ffc){const _0x58d875=_0x3657e3;if(_0xe8b134)console[_0x58d875(0x18c)](_0xe8b134),error_handler_1[_0x58d875(0x174)]['error'](_0x57f2b2,_0x58d875(0x157)+_0xe8b134,0x194);else{error_handler_1[_0x58d875(0x174)][_0x58d875(0x1a9)](_0x57f2b2,'',_0x58d875(0x1a2));let _0xeb1248=0x927c0;new Promise(function(_0x1ad103,_0x194e92){setTimeout(()=>{const _0x223399=a6_0x4040;console[_0x223399(0x18c)]('reset!'),_0x334d65[_0x223399(0x14f)]='We8Z',_0x334d65['save']();},_0xeb1248);});}});}catch(_0x5100c9){console[_0x3657e3(0x15f)](_0x3657e3(0x18e),_0x5100c9),error_handler_1[_0x3657e3(0x174)]['internalServerError'](_0x57f2b2,'Internal\x20server\x20error:\x20'+_0x5100c9);}})),router[a6_0x1941db(0x159)](a6_0x1941db(0x16a),authorise_1[a6_0x1941db(0x163)],(_0x3a9ab5,_0x2a0551)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x413ca7=a6_0x1941db;try{const _0xd9c10b=_0x3a9ab5['userId'],_0x210322=yield User_1[_0x413ca7(0x19d)]['findById'](_0xd9c10b)['select'](_0x413ca7(0x18a));if(!_0x210322){error_handler_1[_0x413ca7(0x174)][_0x413ca7(0x18f)](_0x2a0551,_0x413ca7(0x177));return;}error_handler_1[_0x413ca7(0x174)][_0x413ca7(0x1a9)](_0x2a0551,_0x210322,_0x413ca7(0x194));}catch(_0x1c73fb){console[_0x413ca7(0x15f)](_0x413ca7(0x184),_0x1c73fb),error_handler_1[_0x413ca7(0x174)]['internalServerError'](_0x2a0551,_0x413ca7(0x188)+_0x1c73fb);}})),router[a6_0x1941db(0x191)](a6_0x1941db(0x16a),authorise_1['default'],(_0x35e77b,_0x3c7db2)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x22b5aa=a6_0x1941db;try{const _0x5295b9=_0x35e77b[_0x22b5aa(0x153)],{firstName:_0x2c8902,lastName:_0x4a5fdd,phone:_0x1d7e98,age:_0x14f727,address:_0x36a907}=_0x35e77b[_0x22b5aa(0x17c)];if(!_0x2c8902&&!_0x4a5fdd&&!_0x1d7e98&&!_0x14f727&&!_0x36a907){error_handler_1[_0x22b5aa(0x174)][_0x22b5aa(0x15f)](_0x3c7db2,_0x22b5aa(0x168),0x190);return;}const _0xde5a9=yield User_1[_0x22b5aa(0x19d)]['findByIdAndUpdate'](_0x5295b9,{'$set':{'firstName':_0x2c8902,'lastName':_0x4a5fdd,'phone':_0x1d7e98,'age':_0x14f727,'address':_0x36a907}},{'new':!![],'runValidators':!![]})[_0x22b5aa(0x178)](_0x22b5aa(0x18a));if(!_0xde5a9){error_handler_1[_0x22b5aa(0x174)][_0x22b5aa(0x18f)](_0x3c7db2,_0x22b5aa(0x177));return;}error_handler_1[_0x22b5aa(0x174)][_0x22b5aa(0x1a9)](_0x3c7db2,_0xde5a9,_0x22b5aa(0x155));}catch(_0x884e6f){console[_0x22b5aa(0x15f)](_0x22b5aa(0x14e),_0x884e6f),error_handler_1['ResponseHandler'][_0x22b5aa(0x198)](_0x3c7db2,_0x22b5aa(0x188)+_0x884e6f);}})),router[a6_0x1941db(0x15b)](a6_0x1941db(0x16a),authorise_1['default'],(_0x1ba447,_0x5b5f2c)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2da918=a6_0x1941db;try{const _0x37b2d2=_0x1ba447['userId'],_0x5c092d=yield User_1['User']['findByIdAndDelete'](_0x37b2d2);if(!_0x5c092d){error_handler_1[_0x2da918(0x174)][_0x2da918(0x18f)](_0x5b5f2c,_0x2da918(0x177));return;}console[_0x2da918(0x15f)](_0x2da918(0x165)),yield Display_1[_0x2da918(0x1a3)]['deleteMany']({'ownerId':_0x37b2d2}),error_handler_1[_0x2da918(0x174)][_0x2da918(0x1a9)](_0x5b5f2c,_0x5c092d,_0x2da918(0x16d));}catch(_0x15e2d9){console[_0x2da918(0x15f)](_0x2da918(0x1a5),_0x15e2d9),error_handler_1[_0x2da918(0x174)][_0x2da918(0x198)](_0x5b5f2c,'Internal\x20server\x20error:\x20'+_0x15e2d9);}})),router['post']('/refresh-token',(_0x482566,_0x42ccee)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x330acf=a6_0x1941db;try{const {token:_0x10e490}=_0x482566[_0x330acf(0x17c)];if(!_0x10e490){error_handler_1[_0x330acf(0x174)]['error'](_0x42ccee,_0x330acf(0x15a),0x190);return;}const _0x382fe1=process[_0x330acf(0x18b)][_0x330acf(0x14c)]||'regal_top_secret';let _0x208435;try{_0x208435=jsonwebtoken_1[_0x330acf(0x163)]['decode'](_0x10e490);if(!_0x208435||!_0x208435[_0x330acf(0x171)]||!_0x208435[_0x330acf(0x186)]){error_handler_1[_0x330acf(0x174)]['unauthorized'](_0x42ccee,'Invalid\x20token\x20payload');return;}}catch(_0x48a947){console[_0x330acf(0x15f)](_0x330acf(0x179),_0x48a947),error_handler_1[_0x330acf(0x174)][_0x330acf(0x19e)](_0x42ccee,'Invalid\x20token');return;}try{jsonwebtoken_1[_0x330acf(0x163)][_0x330acf(0x14d)](_0x10e490,_0x382fe1,{'ignoreExpiration':!![]});}catch(_0x5cb9a1){console['warn']('Token\x20signature\x20is\x20invalid:',_0x5cb9a1),error_handler_1[_0x330acf(0x174)][_0x330acf(0x19e)](_0x42ccee,_0x330acf(0x17b));return;}const _0x19bfa9=jsonwebtoken_1[_0x330acf(0x163)][_0x330acf(0x15e)]({'_id':_0x208435['_id'],'email':_0x208435['email']},_0x382fe1,{'expiresIn':'5h'});error_handler_1['ResponseHandler'][_0x330acf(0x1a9)](_0x42ccee,{'token':_0x19bfa9},_0x330acf(0x190));}catch(_0x4bb292){console[_0x330acf(0x15f)]('Refresh\x20Token\x20Error:',_0x4bb292),error_handler_1['ResponseHandler'][_0x330acf(0x198)](_0x42ccee,_0x330acf(0x188)+_0x4bb292);}})),exports[a6_0x1941db(0x163)]=router;